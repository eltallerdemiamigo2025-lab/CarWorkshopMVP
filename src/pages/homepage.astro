---
import FeatureSnippet from "@/components/home/FeatureSnippet.astro";
import WhatsappLinkButton from "@/components/ui/WhatsappLinkButton";
import LinkButton from "@/components/ui/LinkButton.astro";
import Layout from "@/layouts/Layout.astro";
import ServiceCard from "@/components/home/ServiceCard";
import homeBackground from "@/assets/homebackground4.png";
import backgroundMobile from "@/assets/backgroundmobile.png";
import paso1 from "@/assets/logos/paso1.png";
import paso2 from "@/assets/logos/paso2.png";
import paso3 from "@/assets/logos/paso3.png";
import paso4 from "@/assets/logos/paso4.png";
---

<Layout
  title="El Taller de mi Amigo | Recogemos, Reparamos, Entregamos"
  description="Servicio profesional de mantenimiento de vehículos con recogida y entrega en Madrid. Neumáticos, baterías, aceites. Primeras marcas y precios sin sorpresas."
>
  <!-- Hero Section with Background -->
  <section class="w-dvw relative" style={{ height: 'calc(100dvh - 80px)'}}>
    <!-- Desktop background -->
    <img 
      src={homeBackground.src} 
      class="absolute inset-0 w-full h-full object-cover hero-bg-desktop" 
      alt="Background desktop"
    />
    <!-- Mobile background -->
    <img 
      src={backgroundMobile.src} 
      class="absolute inset-0 w-full h-full object-cover hero-bg-mobile" 
      alt="Background mobile"
    />
    <div class="bg-black/60 absolute inset-0" />
    
    <!-- Contenedor centrado con flexbox -->
    <div class="absolute inset-0 flex items-center justify-center">
      <div class="text-white flex flex-col items-center px-4 py-8 max-w-5xl mx-auto">
        <h1 class="text-3xl sm:text-4xl lg:text-5xl text-center font-semibold mb-4 sm:mb-6">
          Recogemos, reparamos, entregamos
        </h1>

        <p class="max-w-4xl text-base sm:text-lg text-center leading-relaxed mb-6 sm:mb-8">
          Recogemos su vehículo en su domicilio o empresa. Lo revisamos y
          reparamos en nuestro taller. <br class="hidden sm:block" /> 
          <span class="block sm:inline">Te lo entregamos de vuelta en su destino.</span>
        </p>

        <article class="flex justify-center gap-2 flex-col sm:flex-row w-full sm:w-auto">
          <LinkButton href="#servicios" text="Ver servicios" />
          <WhatsappLinkButton href="/contacto" text="Contactar" />
        </article>
      </div>
    </div>
  </section>

  <!-- Rest of Content -->
  <main class="flex flex-col items-end justify-center">
    <article
      class="max-w-6xl mx-auto mt-12 grid gap-12 grid-cols-1 md:grid-cols-2 lg:grid-cols-4"
    >
      <FeatureSnippet
        title="Solicitud"
        description="Solicita el servicio desde la comodidad de tu casa."
        imageUrl={paso1.src}
      />

      <FeatureSnippet
        title="Recogida"
        description="Recogemos el vehículo en el momento y lugar que nos indiques."
        imageUrl={paso2.src}
      />

      <FeatureSnippet
        title="Reparación"
        description="Reparamos el vehículo en nuestro taller y le hacemos una revisión general gratuita."
        imageUrl={paso3.src}
        imageSize="w-40"
      />
      <FeatureSnippet
        title="Entrega"
        description="Tras terminar, te lo entregamos en el momento y lugar que nos indiques."
        imageUrl={paso4.src}
      />
    </article>

    <article class="max-w-4xl mx-auto mt-24 mb-12">
      <h2 class="text-3xl text-center font-semibold">
        Descubre nuestros <span class="title-secondary">servicios</span>
      </h2>

      <div id="servicios" class="mt-6 grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3 scroll-mt-20">
        <ServiceCard
          title="Neumáticos"
          description="Cambio y equilibrado de neumáticos para una conducción segura y eficiente."
          icon="car"
        />
        <ServiceCard
          title="Baterías"
          description="Diagnóstico y reemplazo de baterías para asegurar el arranque de tu vehículo."
          icon="battery"
        />
        <ServiceCard
          title="Aceites y filtros"
          description="Cambio de aceite y filtros para mantener el motor de tu coche en óptimas condiciones."
          icon="fuel"
        />
        <ServiceCard
          title="Frenos"
          description="Revisión y cambio de pastillas y discos de freno para tu seguridad en carretera."
          icon="brakes"
        />
        <ServiceCard
          title="Mecánica General"
          description="Reparaciones y mantenimiento general para el buen funcionamiento de tu vehículo."
          icon="mechanic"
        />
      </div>
    </article>
  </main>
</Layout>

<style>
  html {
    scroll-behavior: smooth;
  }
  
  /* Background image switching for mobile */
  .hero-bg-desktop {
    display: block;
  }
  
  .hero-bg-mobile {
    display: none;
  }
  
  @media (max-width: 768px) {
    .hero-bg-desktop {
      display: none;
    }
    
    .hero-bg-mobile {
      display: block;
    }
  }
  
  /* Fallback para navegadores que no soporten scroll-behavior */
  @media (prefers-reduced-motion: no-preference) {
    html {
      scroll-behavior: smooth;
    }
  }
  
  /* Para usuarios que prefieren movimiento reducido */
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }
</style>

<script>
  // Script adicional para asegurar compatibilidad en todos los navegadores
  document.addEventListener('DOMContentLoaded', () => {
    // Seleccionar todos los enlaces que apuntan a anclas
    const anchorLinks = document.querySelectorAll('a[href^="#"]') as NodeListOf<HTMLAnchorElement>;
    
    anchorLinks.forEach(link => {
      link.addEventListener('click', (e: Event) => {
        const target = e.currentTarget as HTMLAnchorElement;
        const href = target.getAttribute('href');
        const targetElement = href ? document.querySelector(href) : null;
        
        if (targetElement) {
          e.preventDefault();
          
          // Calcular la posición teniendo en cuenta el header
          const headerOffset = 100; // Ajusta según la altura de tu header
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
          
          // Desplazamiento suave
          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
    });
  });
</script>