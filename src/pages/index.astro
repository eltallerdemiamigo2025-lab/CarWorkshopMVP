---
import FeatureSnippet from "@/components/home/FeatureSnippet.astro";
import WhatsappLinkButton from "@/components/ui/WhatsappLinkButton";
import LinkButton from "@/components/ui/LinkButton.astro";
import Layout from "@/layouts/Layout.astro";
import ServiceCard from "@/components/home/ServiceCard";
import homeBackground from "@/assets/homebackground4.png";
import backgroundMobile from "@/assets/backgroundmobile15.png";
import paso1 from "@/assets/logos/paso1.png";
import paso2 from "@/assets/logos/paso2.png";
import paso3 from "@/assets/logos/paso3.png";
import paso4 from "@/assets/logos/paso4.png";
---

<Layout
  title="El Taller de mi Amigo | Recogemos, Reparamos, Entregamos"
  description="Servicio profesional de mantenimiento de vehículos con recogida y entrega en Madrid. Neumáticos, baterías, aceites. Primeras marcas y precios sin sorpresas."
>
  <!-- Hero Section with Background -->
  <section class="min-h-screen w-full relative" style={{ height: 'calc(100dvh - 80px)'}}>
    <!-- Desktop background -->
    <div
      class="absolute inset-0 w-full h-full bg-cover bg-center bg-no-repeat md:block hidden"
      style={{ backgroundImage: `url(${homeBackground.src})` }}
    ></div>
    <!-- Mobile background -->
    <div
      class="absolute inset-0 w-full h-full bg-cover bg-center bg-no-repeat md:hidden block"
      style={{ backgroundImage: `url(${backgroundMobile.src})` }}
    ></div>
    <div class="bg-black/60 absolute inset-0" />

    <!-- Contenedor centrado con flexbox - Ajustado más abajo -->
    <div class="absolute inset-0 flex items-center justify-center px-4 sm:px-6 lg:px-8" style="padding-top: 8vh;">
      <div class="text-white flex flex-col items-center py-8 max-w-6xl mx-auto w-full mb-10">
        <!-- Título con tamaños reducidos -->
        <h1 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl text-center font-semibold mb-4 sm:mb-6 lg:mb-8 leading-tight">
          Recogemos, reparamos, entregamos
        </h1>

        <!-- Párrafo con tamaños reducidos -->
        <p class="max-w-4xl text-xs sm:text-sm md:text-base lg:text-lg text-center leading-relaxed mb-6 sm:mb-8 lg:mb-10 px-2">
          Recogemos su vehículo en su domicilio o empresa. Lo revisamos y
          reparamos en nuestro taller. <br class="hidden sm:block" />
          <span class="block sm:inline">Te lo entregamos de vuelta en su destino.</span>
        </p>

        <!-- Botones manteniendo el tamaño original -->
        <article class="flex justify-center gap-3 sm:gap-4 flex-row w-full max-w-md sm:max-w-lg">
          <LinkButton href="#servicios" text="Ver servicios" />
          <WhatsappLinkButton href="/contacto" text="Contactar" />
        </article>
      </div>
    </div>
  </section>

  <!-- Rest of Content -->
  <main class="flex flex-col items-center justify-center">
    <!-- FeatureSnippet Section -->
    <article
      class="max-w-7xl mx-auto mt-16 sm:mt-20 lg:mt-24 px-4 sm:px-6 lg:px-8 grid gap-8 sm:gap-12 lg:gap-16 grid-cols-1 md:grid-cols-2 lg:grid-cols-4"
    >
      <FeatureSnippet
        title="Solicitud"
        description="Solicita el servicio desde la comodidad de tu casa."
        imageUrl={paso1.src}
      />

      <FeatureSnippet
        title="Recogida"
        description="Recogemos el vehículo en el momento y lugar que nos indiques."
        imageUrl={paso2.src}
      />

      <FeatureSnippet
        title="Reparación"
        description="Reparamos el vehículo en nuestro taller y le hacemos una revisión general gratuita."
        imageUrl={paso3.src}
        imageSize="w-40"
      />
      <FeatureSnippet
        title="Entrega"
        description="Tras terminar, te lo entregamos en el momento y lugar que nos indiques."
        imageUrl={paso4.src}
      />
    </article>

    <!-- Service Areas Banner - Movido aquí -->
    <section class="bg-gray-50 py-16 sm:py-20 lg:py-24 w-full mt-16 sm:mt-20 lg:mt-24">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-8 sm:mb-10 lg:mb-12">
          <h2 class="text-2xl sm:text-3xl lg:text-4xl font-semibold mb-4">
            Zonas de <span class="title-secondary">servicio</span>
          </h2>
          <p class="text-base sm:text-lg text-gray-600 max-w-3xl mx-auto">
            Ofrecemos nuestro servicio de recogida y entrega en las siguientes zonas de Madrid
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
          <!-- Lista de zonas - Izquierda -->
          <div class="bg-white rounded-2xl p-6 sm:p-8 shadow-lg">
            <h3 class="text-xl sm:text-2xl font-semibold mb-6 text-center lg:text-left">
              Municipios disponibles
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4">
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-gray-800 font-medium">Majadahonda</span>
              </div>
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-gray-800 font-medium">Boadilla del Monte</span>
              </div>
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-gray-800 font-medium">Pozuelo de Alarcón</span>
              </div>
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-gray-800 font-medium">Alcorcón</span>
              </div>
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-gray-800 font-medium">Leganés</span>
              </div>
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-gray-800 font-medium">Getafe</span>
              </div>
              <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-gray-800 font-medium">Arroyomolinos</span>
              </div>
            </div>
          </div>

          <!-- Mapa - Derecha -->
          <div class="bg-white rounded-2xl p-4 shadow-lg">
            <div id="service-map" class="w-full h-80 sm:h-96 rounded-xl"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Services Section -->
    <article class="max-w-6xl mx-auto mt-20 sm:mt-24 lg:mt-32 mb-16 sm:mb-20 lg:mb-24 px-4 sm:px-6 lg:px-8">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl text-center font-semibold mb-8 sm:mb-10 lg:mb-12">
        Descubre nuestros <span class="title-secondary">servicios</span>
      </h2>

      <div id="servicios" class="mt-8 sm:mt-10 lg:mt-12 grid grid-cols-1 gap-6 sm:gap-8 lg:gap-10 md:grid-cols-2 lg:grid-cols-3 scroll-mt-20">
        <ServiceCard
          title="Neumáticos"
          description="Cambio y equilibrado de neumáticos para una conducción segura y eficiente."
          icon="car"
        />
        <ServiceCard
          title="Baterías"
          description="Diagnóstico y reemplazo de baterías para asegurar el arranque de tu vehículo."
          icon="battery"
        />
        <ServiceCard
          title="Aceites y filtros"
          description="Cambio de aceite y filtros para mantener el motor de tu coche en óptimas condiciones."
          icon="fuel"
        />
        <ServiceCard
          title="Frenos"
          description="Revisión y cambio de pastillas y discos de freno para tu seguridad en carretera."
          icon="brakes"
        />
        <ServiceCard
          title="Mecánica General"
          description="Reparaciones y mantenimiento general para el buen funcionamiento de tu vehículo."
          icon="mechanic"
        />
      </div>
    </article>
  </main>
</Layout>

<style>
  html {
    scroll-behavior: smooth;
  }

  /* Fallback para navegadores que no soporten scroll-behavior */
  @media (prefers-reduced-motion: no-preference) {
    html {
      scroll-behavior: smooth;
    }
  }

  /* Para usuarios que prefieren movimiento reducido */
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }
</style>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  declare const L: any;
  // Script adicional para asegurar compatibilidad en todos los navegadores
  document.addEventListener('DOMContentLoaded', () => {
    // Seleccionar todos los enlaces que apuntan a anclas
    const anchorLinks = document.querySelectorAll('a[href^="#"]') as NodeListOf<HTMLAnchorElement>;

    anchorLinks.forEach(link => {
      link.addEventListener('click', (e: Event) => {
        const target = e.currentTarget as HTMLAnchorElement;
        const href = target.getAttribute('href');
        const targetElement = href ? document.querySelector(href) : null;

        if (targetElement) {
          e.preventDefault();

          // Calcular la posición teniendo en cuenta el header
          const headerOffset = 100; // Ajusta según la altura de tu header
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

          // Desplazamiento suave
          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      });
    });

    // Inicializar el mapa de zonas de servicio
    const mapElement = document.getElementById('service-map');
    if (mapElement) {
      // Coordenadas del centro de Madrid (aproximadamente entre todas las zonas)
      const centerLat = 40.3833;
      const centerLng = -3.8167;
      
      // Crear el mapa
      const map = L.map('service-map').setView([centerLat, centerLng], 11);
      
      // Añadir capa de mapa (OpenStreetMap)
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      // Zonas de servicio con sus coordenadas
      const serviceAreas = [
        { name: 'Majadahonda', lat: 40.4734, lng: -3.8704 },
        { name: 'Boadilla del Monte', lat: 40.4069, lng: -3.8772 },
        { name: 'Pozuelo de Alarcón', lat: 40.4338, lng: -3.8123 },
        { name: 'Alcorcón', lat: 40.3458, lng: -3.8258 },
        { name: 'Leganés', lat: 40.3272, lng: -3.7637 },
        { name: 'Getafe', lat: 40.3057, lng: -3.7327 },
        { name: 'Arroyomolinos', lat: 40.2714, lng: -3.9181 }
      ];

      // Crear un icono personalizado
      const customIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background-color: #3b82f6; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
        iconSize: [16, 16],
        iconAnchor: [8, 8]
      });

      // Añadir marcadores para cada zona
      serviceAreas.forEach(area => {
        L.marker([area.lat, area.lng], { icon: customIcon })
          .bindPopup(`<strong>${area.name}</strong><br>Zona de servicio`)
          .addTo(map);
      });

      // Ajustar el zoom para mostrar todas las zonas
      const group = new L.featureGroup(
        serviceAreas.map(area => L.marker([area.lat, area.lng]))
      );
      map.fitBounds(group.getBounds().pad(0.1));
    }
  });
</script>